"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var incident_1 = require("incident");
var _ = require("lodash");
var user_data_processor_1 = require("./user-data-processor");
function formatConversation(native) {
    // TODO: parse id
    if (native.id.indexOf("19:") === 0) {
        return native;
    }
    else {
        var contact = native.id;
        var result = native;
        result.members = [contact];
        return result;
    }
}
exports.formatConversation = formatConversation;
function formatThread(native) {
    var memberIds = _.map(native.members, (function (member) { return member.id; }));
    var properties = {};
    if ("properties" in native) {
        if ("topic" in native.properties) {
            properties.topic = native.properties.topic;
        }
        if ("lastjoinat" in native.properties) {
            properties.topic = native.properties.lastjoinat;
        }
        if ("version" in native.properties) {
            properties.topic = native.properties.version;
        }
    }
    return {
        threadProperties: properties,
        id: native.id,
        type: native.type,
        version: native.version,
        members: memberIds
    };
}
exports.formatThread = formatThread;
function formatContact(native) {
    return contactToPerson(native);
}
exports.formatContact = formatContact;
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/agentToPerson.js
function agentToPerson(native) {
}
// TODO: check that the uri uses the HTTPS protocol
function ensureHttps(uri) {
    return uri;
}
function define() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    return null;
}
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/contactToPerson.js
function contactToPerson(native) {
    var SUGGESTED_CONTACT_ACTIVITY_MESSAGE = "Skype";
    // TODO(demurgos): typedef
    // tslint:disable-next-line:typedef
    var authorizationStates = {
        UNKNOWN: "UNKNOWN",
        UNAUTHORIZED: "UNAUTHORIZED",
        PENDING_OUTGOING: "PENDING_OUTGOING",
        PENDING_INCOMING: "PENDING_INCOMING",
        AUTHORIZED: "AUTHORIZED",
        SUGGESTED: "SUGGESTED"
    };
    // TODO(demurgos): typedef
    // tslint:disable-next-line:typedef
    var showStrategies = {
        ALL: "ALL",
        AVAILABLE_ONLY: "AVAILABLE_ONLY",
        AGENTS_ONLY: "AGENTS_ONLY"
    };
    var activityMessage;
    if (native.suggested === true) {
        activityMessage = SUGGESTED_CONTACT_ACTIVITY_MESSAGE;
    }
    else {
        activityMessage = native.mood === undefined ? null : native.mood;
    }
    var capabilities;
    if (native.type === "agent") {
        capabilities = native.agent.capabilities;
    }
    else if (native.type === "pstn") {
        capabilities = ["audio.receive", "group.add"];
    }
    else {
        capabilities = [];
    }
    var authorizationState;
    if (native.authorized) {
        authorizationState = authorizationStates.AUTHORIZED;
    }
    else if (native.suggested) {
        authorizationState = authorizationStates.SUGGESTED;
    }
    else {
        authorizationState = authorizationStates.PENDING_OUTGOING;
    }
    var typeKey = contactTypeNameToContactTypeKey(native.type);
    var isAgent = native.type === "agent";
    var avatarUrl;
    if (native.avatar_url) {
        avatarUrl = ensureHttps(native.avatar_url);
        // TODO: ensure that the "cacheHeaders=1" queryString is there
    }
    else {
        avatarUrl = null;
    }
    var displayName = user_data_processor_1.sanitizeXml(native.display_name);
    var firstName = user_data_processor_1.sanitizeXml(native.name.first);
    var lastName = native.name.surname === undefined ? null : user_data_processor_1.sanitizeXml(native.name.surname);
    var phoneNumbers = [];
    var locations = [];
    var result;
    result = {
        id: {
            id: native.id,
            typeKey: typeKey,
            typeName: native.type,
            raw: typeKey + ":" + native.id
        },
        avatarUrl: avatarUrl,
        phones: phoneNumbers,
        name: {
            first: firstName,
            surname: "",
            nickname: native.id
        },
        activityMessage: activityMessage,
        locations: locations
    };
    return result;
}
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/dataMaps.js
function contactTypeNameToContactTypeKey(typeName) {
    switch (typeName) {
        case "msn": return "1";
        case "lync": return "2";
        case "pstn": return "4"; // Public switched telephone network
        case "skype": return "8";
        case "agent": return "28";
        default: throw new incident_1.Incident("unknown-contact-type-name", { typeName: typeName }, "Unknwon contact type name " + typeName);
    }
}
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/dataMaps.js
function contactTypeKeyToContactTypeName(typeKey) {
    switch (typeKey) {
        case "1": return "msn";
        case "2": return "lync";
        case "4": return "pstn"; // Public switched telephone network
        case "8": return "skype";
        case "28": return "agent";
        default: throw new incident_1.Incident("unknown-contact-type-key", { typeCode: typeKey }, "Unknwon contact type key " + typeKey);
    }
}
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/dataMaps.js
function phoneTypeNameToPhoneTypeKey(typeName) {
    switch (typeName) {
        case "Home": return "0";
        case "Work": return "1";
        case "Cell": return "2";
        case "Other": return "3";
        default: throw new incident_1.Incident("unknown-phone-type-name", { typeName: typeName }, "Unknwon phone type name " + typeName);
    }
}
// github:demurgos/skype-web-reversed -> jSkype/modelHelpers/contacts/dataMappers/dataMaps.js
function phoneTypeKeyToPhoneTypeName(typeKey) {
    switch (typeKey) {
        case "0": return "Home";
        case "1": return "Work";
        case "2": return "Cell";
        case "3": return "Other";
        default: throw new incident_1.Incident("unknown-phone-type-key", { typeCode: typeKey }, "Unknwon phone type key " + typeKey);
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91dGlscy9mb3JtYXR0ZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEscUNBQWtDO0FBQ2xDLDBCQUE0QjtBQVE1Qiw2REFBa0Q7QUFFbEQsNEJBQW9DLE1BQTBCO0lBQzVELGlCQUFpQjtJQUNqQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sSUFBTSxPQUFPLEdBQVcsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNsQyxJQUFNLE1BQU0sR0FBaUIsTUFBTSxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2hCLENBQUM7QUFDSCxDQUFDO0FBVkQsZ0RBVUM7QUFFRCxzQkFBOEIsTUFBb0I7SUFDaEQsSUFBTSxTQUFTLEdBQWEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsVUFBQyxNQUEwQixJQUFhLE9BQUEsTUFBTSxDQUFDLEVBQUUsRUFBVCxDQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ3ZHLElBQU0sVUFBVSxHQUFxQixFQUFFLENBQUM7SUFFeEMsRUFBRSxDQUFDLENBQUMsWUFBWSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDM0IsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUM7UUFDN0MsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLFlBQVksSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN0QyxVQUFVLENBQUMsS0FB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dH0gZnJvbSBcImluY2lkZW50XCI7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSBcImxvZGFzaFwiO1xyXG5pbXBvcnQge0NvbnRhY3R9IGZyb20gXCIuLi9pbnRlcmZhY2VzL2FwaS9jb250YWN0XCI7XHJcbmltcG9ydCB7Q29udmVyc2F0aW9uLCBUaHJlYWRQcm9wZXJ0aWVzfSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9hcGkvY29udmVyc2F0aW9uXCI7XHJcbmltcG9ydCB7Q29udGFjdCBhcyBOYXRpdmVDb250YWN0fSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9uYXRpdmUtYXBpL2NvbnRhY3RcIjtcclxuaW1wb3J0IHtcclxuICBDb252ZXJzYXRpb24gYXMgTmF0aXZlQ29udmVyc2F0aW9uLCBUaHJlYWQgYXMgTmF0aXZlVGhyZWFkLFxyXG4gIFRocmVhZE1lbWJlciBhcyBOYXRpdmVUaHJlYWRNZW1iZXJcclxufSBmcm9tIFwiLi4vaW50ZXJmYWNlcy9uYXRpdmUtYXBpL2NvbnZlcnNhdGlvblwiO1xyXG5pbXBvcnQge3Nhbml0aXplWG1sfSBmcm9tIFwiLi91c2VyLWRhdGEtcHJvY2Vzc29yXCI7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0Q29udmVyc2F0aW9uIChuYXRpdmU6IE5hdGl2ZUNvbnZlcnNhdGlvbik6IENvbnZlcnNhdGlvbiB7XHJcbiAgLy8gVE9ETzogcGFyc2UgaWRcclxuICBpZiAobmF0aXZlLmlkLmluZGV4T2YoXCIxOTpcIikgPT09IDApIHsgLy8gdGhyZWFkXHJcbiAgICByZXR1cm4gbmF0aXZlO1xyXG4gIH0gZWxzZSB7IC8vIHByaXZhdGVcclxuICAgIGNvbnN0IGNvbnRhY3Q6IHN0cmluZyA9IG5hdGl2ZS5pZDtcclxuICAgIGNvbnN0IHJlc3VsdDogQ29udmVyc2F0aW9uID0gbmF0aXZlO1xyXG4gICAgcmVzdWx0Lm1lbWJlcnMgPSBbY29udGFjdF07XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFRocmVhZCAobmF0aXZlOiBOYXRpdmVUaHJlYWQpOiBDb252ZXJzYXRpb24ge1xyXG4gIGNvbnN0IG1lbWJlcklkczogc3RyaW5nW10gPSBfLm1hcChuYXRpdmUubWVtYmVycywgKChtZW1iZXI6IE5hdGl2ZVRocmVhZE1lbWJlcik6IHN0cmluZyA9PiBtZW1iZXIuaWQpKTtcclxuICBjb25zdCBwcm9wZXJ0aWVzOiBUaHJlYWRQcm9wZXJ0aWVzID0ge307XHJcblxyXG4gIGlmIChcInByb3BlcnRpZXNcIiBpbiBuYXRpdmUpIHtcclxuICAgIGlmIChcInRvcGljXCIgaW4gbmF0aXZlLnByb3BlcnRpZXMpIHtcclxuICAgICAgcHJvcGVydGllcy50b3BpYyA9IG5hdGl2ZS5wcm9wZXJ0aWVzLnRvcGljO1xyXG4gICAgfVxyXG4gICAgaWYgKFwibGFzdGpvaW5hdFwiIGluIG5hdGl2ZS5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgIHByb3BlcnRpZXMudG9waWMgPSBuYXRpdmUucHJvcGVydGllcy5sYXN0am9pbmF0O1xyXG4gICAgfVxyXG4gICAgaWYgKFwidmVyc2lvblwiIGluIG5hdGl2ZS5wcm9wZXJ0aWVzKSB7XHJcbiAgICAgIHByb3BlcnRpZXMudG9waWMgPSBuYXRpdmUucHJvcGVydGllcy52ZXJzaW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHRocmVhZFByb3BlcnRpZXM6IHByb3BlcnRpZXMsXHJcbiAgICBpZDogbmF0aXZlLmlkLFxyXG4gICAgdHlwZTogbmF0aXZlLnR5cGUsXHJcbiAgICB2ZXJzaW9uOiBuYXRpdmUudmVyc2lvbixcclxuICAgIG1lbWJlcnM6IG1lbWJlcklkc1xyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRDb250YWN0IChuYXRpdmU6IE5hdGl2ZUNvbnRhY3QpOiBDb250YWN0IHtcclxuICByZXR1cm4gY29udGFjdFRvUGVyc29uKG5hdGl2ZSk7XHJcbn1cclxuXHJcbi8vIGdpdGh1YjpkZW11cmdvcy9za3lwZS13ZWItcmV2ZXJzZWQgLT4galNreXBlL21vZGVsSGVscGVycy9jb250YWN0cy9kYXRhTWFwcGVycy9hZ2VudFRvUGVyc29uLmpzXHJcbmZ1bmN0aW9uIGFnZW50VG9QZXJzb24gKG5hdGl2ZTogYW55KTogYW55IHtcclxuXHJcbn1cclxuXHJcbi8vIFRPRE86IGNoZWNrIHRoYXQgdGhlIHVyaSB1c2VzIHRoZSBIVFRQUyBwcm90b2NvbFxyXG5mdW5jdGlvbiBlbnN1cmVIdHRwcyAodXJpOiBzdHJpbmcpIHtcclxuICByZXR1cm4gdXJpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBkZWZpbmUgKC4uLmFyZ3M6IGFueVtdKSB7XHJcbiAgcmV0dXJuIG51bGw7XHJcbn1cclxuXHJcbi8vIGdpdGh1YjpkZW11cmdvcy9za3lwZS13ZWItcmV2ZXJzZWQgLT4galNreXBlL21vZGVsSGVscGVycy9jb250YWN0cy9kYXRhTWFwcGVycy9jb250YWN0VG9QZXJzb24uanNcclxuZnVuY3Rpb24gY29udGFjdFRvUGVyc29uIChuYXRpdmU6IE5hdGl2ZUNvbnRhY3QpOiBDb250YWN0IHtcclxuICBjb25zdCBTVUdHRVNURURfQ09OVEFDVF9BQ1RJVklUWV9NRVNTQUdFOiBzdHJpbmcgPSBcIlNreXBlXCI7XHJcblxyXG4gIC8vIFRPRE8oZGVtdXJnb3MpOiB0eXBlZGVmXHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnR5cGVkZWZcclxuICBjb25zdCBhdXRob3JpemF0aW9uU3RhdGVzID0ge1xyXG4gICAgVU5LTk9XTjogXCJVTktOT1dOXCIsXHJcbiAgICBVTkFVVEhPUklaRUQ6IFwiVU5BVVRIT1JJWkVEXCIsXHJcbiAgICBQRU5ESU5HX09VVEdPSU5HOiBcIlBFTkRJTkdfT1VUR09JTkdcIixcclxuICAgIFBFTkRJTkdfSU5DT01JTkc6IFwiUEVORElOR19JTkNPTUlOR1wiLFxyXG4gICAgQVVUSE9SSVpFRDogXCJBVVRIT1JJWkVEXCIsXHJcbiAgICBTVUdHRVNURUQ6IFwiU1VHR0VTVEVEXCJcclxuICB9O1xyXG5cclxuICAvLyBUT0RPKGRlbXVyZ29zKTogdHlwZWRlZlxyXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0eXBlZGVmXHJcbiAgY29uc3Qgc2hvd1N0cmF0ZWdpZXMgPSB7XHJcbiAgICBBTEw6IFwiQUxMXCIsXHJcbiAgICBBVkFJTEFCTEVfT05MWTogXCJBVkFJTEFCTEVfT05MWVwiLFxyXG4gICAgQUdFTlRTX09OTFk6IFwiQUdFTlRTX09OTFlcIlxyXG4gIH07XHJcblxyXG4gIGxldCBhY3Rpdml0eU1lc3NhZ2U6IHN0cmluZyB8IG51bGw7XHJcbiAgaWYgKG5hdGl2ZS5zdWdnZXN0ZWQgPT09IHRydWUpIHtcclxuICAgIGFjdGl2aXR5TWVzc2FnZSA9IFNVR0dFU1RFRF9DT05UQUNUX0FDVElWSVRZX01FU1NBR0U7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFjdGl2aXR5TWVzc2FnZSA9IG5hdGl2ZS5tb29kID09PSB1bmRlZmluZWQgPyBudWxsIDogbmF0aXZlLm1vb2Q7XHJcbiAgfVxyXG5cclxuICBsZXQgY2FwYWJpbGl0aWVzOiBzdHJpbmdbXTtcclxuICBpZiAobmF0aXZlLnR5cGUgPT09IFwiYWdlbnRcIikge1xyXG4gICAgY2FwYWJpbGl0aWVzID0gbmF0aXZlLmFnZW50LmNhcGFiaWxpdGllcztcclxuICB9IGVsc2UgaWYgKG5hdGl2ZS50eXBlID09PSBcInBzdG5cIikge1xyXG4gICAgY2FwYWJpbGl0aWVzID0gW1wiYXVkaW8ucmVjZWl2ZVwiLCBcImdyb3VwLmFkZFwiXTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2FwYWJpbGl0aWVzID0gW107XHJcbiAgfVxyXG5cclxuICBsZXQgYXV0aG9yaXphdGlvblN0YXRlOiBzdHJpbmc7XHJcbiAgaWYgKG5hdGl2ZS5hdXRob3JpemVkKSB7XHJcbiAgICBhdXRob3JpemF0aW9uU3RhdGUgPSBhdXRob3JpemF0aW9uU3RhdGVzLkFVVEhPUklaRUQ7XHJcbiAgfSBlbHNlIGlmIChuYXRpdmUuc3VnZ2VzdGVkKSB7XHJcbiAgICBhdXRob3JpemF0aW9uU3RhdGUgPSBhdXRob3JpemF0aW9uU3RhdGVzLlNVR0dFU1RFRDtcclxuICB9IGVsc2Uge1xyXG4gICAgYXV0aG9yaXphdGlvblN0YXRlID0gYXV0aG9yaXphdGlvblN0YXRlcy5QRU5ESU5HX09VVEdPSU5HO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdHlwZUtleTogc3RyaW5nID0gY29udGFjdFR5cGVOYW1lVG9Db250YWN0VHlwZUtleSAobmF0aXZlLnR5cGUpO1xyXG4gIGNvbnN0IGlzQWdlbnQ6IGJvb2xlYW4gPSBuYXRpdmUudHlwZSA9PT0gXCJhZ2VudFwiO1xyXG5cclxuICBsZXQgYXZhdGFyVXJsOiBzdHJpbmcgfCBudWxsO1xyXG5cclxuICBpZiAobmF0aXZlLmF2YXRhcl91cmwpIHtcclxuICAgIGF2YXRhclVybCA9IGVuc3VyZUh0dHBzKG5hdGl2ZS5hdmF0YXJfdXJsKTtcclxuICAgIC8vIFRPRE86IGVuc3VyZSB0aGF0IHRoZSBcImNhY2hlSGVhZGVycz0xXCIgcXVlcnlTdHJpbmcgaXMgdGhlcmVcclxuICB9IGVsc2Uge1xyXG4gICAgYXZhdGFyVXJsID0gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRpc3BsYXlOYW1lOiBzdHJpbmcgPSBzYW5pdGl6ZVhtbChuYXRpdmUuZGlzcGxheV9uYW1lKTtcclxuICBjb25zdCBmaXJzdE5hbWU6IHN0cmluZyA9IHNhbml0aXplWG1sKG5hdGl2ZS5uYW1lLmZpcnN0KTtcclxuICBjb25zdCBsYXN0TmFtZTogc3RyaW5nIHwgbnVsbCA9IG5hdGl2ZS5uYW1lLnN1cm5hbWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBzYW5pdGl6ZVhtbChuYXRpdmUubmFtZS5zdXJuYW1lKTtcclxuXHJcbiAgY29uc3QgcGhvbmVOdW1iZXJzOiBhbnlbXSA9IFtdO1xyXG4gIGNvbnN0IGxvY2F0aW9uczogYW55W10gPSBbXTtcclxuXHJcbiAgbGV0IHJlc3VsdDogQ29udGFjdDtcclxuICByZXN1bHQgPSB7XHJcbiAgICBpZDoge1xyXG4gICAgICBpZDogbmF0aXZlLmlkLFxyXG4gICAgICB0eXBlS2V5OiB0eXBlS2V5LFxyXG4gICAgICB0eXBlTmFtZTogbmF0aXZlLnR5cGUsXHJcbiAgICAgIHJhdzogYCR7dHlwZUtleX06JHtuYXRpdmUuaWR9YFxyXG4gICAgfSxcclxuICAgIGF2YXRhclVybDogYXZhdGFyVXJsLFxyXG4gICAgcGhvbmVzOiBwaG9uZU51bWJlcnMsXHJcbiAgICBuYW1lOiB7XHJcbiAgICAgIGZpcnN0OiBmaXJzdE5hbWUsXHJcbiAgICAgIHN1cm5hbWU6IFwiXCIsXHJcbiAgICAgIG5pY2tuYW1lOiBuYXRpdmUuaWRcclxuICAgIH0sXHJcbiAgICBhY3Rpdml0eU1lc3NhZ2U6IGFjdGl2aXR5TWVzc2FnZSxcclxuICAgIGxvY2F0aW9uczogbG9jYXRpb25zXHJcbiAgfTtcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG4vLyBnaXRodWI6ZGVtdXJnb3Mvc2t5cGUtd2ViLXJldmVyc2VkIC0+IGpTa3lwZS9tb2RlbEhlbHBlcnMvY29udGFjdHMvZGF0YU1hcHBlcnMvZGF0YU1hcHMuanNcclxuZnVuY3Rpb24gY29udGFjdFR5cGVOYW1lVG9Db250YWN0VHlwZUtleSAodHlwZU5hbWU6IHN0cmluZykge1xyXG4gIHN3aXRjaCAodHlwZU5hbWUpIHtcclxuICAgIGNhc2UgXCJtc25cIjogcmV0dXJuIFwiMVwiO1xyXG4gICAgY2FzZSBcImx5bmNcIjogcmV0dXJuIFwiMlwiO1xyXG4gICAgY2FzZSBcInBzdG5cIjogcmV0dXJuIFwiNFwiOyAvLyBQdWJsaWMgc3dpdGNoZWQgdGVsZXBob25lIG5ldHdvcmtcclxuICAgIGNhc2UgXCJza3lwZVwiOiByZXR1cm4gXCI4XCI7XHJcbiAgICBjYXNlIFwiYWdlbnRcIjogcmV0dXJuIFwiMjhcIjtcclxuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBJbmNpZGVudCAoXHJcbiAgICAgIFwidW5rbm93bi1jb250YWN0LXR5cGUtbmFtZVwiLFxyXG4gICAgICB7dHlwZU5hbWU6IHR5cGVOYW1lfSxcclxuICAgICAgYFVua253b24gY29udGFjdCB0eXBlIG5hbWUgJHt0eXBlTmFtZX1gXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gZ2l0aHViOmRlbXVyZ29zL3NreXBlLXdlYi1yZXZlcnNlZCAtPiBqU2t5cGUvbW9kZWxIZWxwZXJzL2NvbnRhY3RzL2RhdGFNYXBwZXJzL2RhdGFNYXBzLmpzXHJcbmZ1bmN0aW9uIGNvbnRhY3RUeXBlS2V5VG9Db250YWN0VHlwZU5hbWUgKHR5cGVLZXk6IHN0cmluZykge1xyXG4gIHN3aXRjaCAodHlwZUtleSkge1xyXG4gICAgY2FzZSBcIjFcIjogcmV0dXJuIFwibXNuXCI7XHJcbiAgICBjYXNlIFwiMlwiOiByZXR1cm4gXCJseW5jXCI7XHJcbiAgICBjYXNlIFwiNFwiOiByZXR1cm4gXCJwc3RuXCI7IC8vIFB1YmxpYyBzd2l0Y2hlZCB0ZWxlcGhvbmUgbmV0d29ya1xyXG4gICAgY2FzZSBcIjhcIjogcmV0dXJuIFwic2t5cGVcIjtcclxuICAgIGNhc2UgXCIyOFwiOiByZXR1cm4gXCJhZ2VudFwiO1xyXG4gICAgZGVmYXVsdDogdGhyb3cgbmV3IEluY2lkZW50IChcclxuICAgICAgXCJ1bmtub3duLWNvbnRhY3QtdHlwZS1rZXlcIixcclxuICAgICAge3R5cGVDb2RlOiB0eXBlS2V5fSxcclxuICAgICAgYFVua253b24gY29udGFjdCB0eXBlIGtleSAke3R5cGVLZXl9YFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIGdpdGh1YjpkZW11cmdvcy9za3lwZS13ZWItcmV2ZXJzZWQgLT4galNreXBlL21vZGVsSGVscGVycy9jb250YWN0cy9kYXRhTWFwcGVycy9kYXRhTWFwcy5qc1xyXG5mdW5jdGlvbiBwaG9uZVR5cGVOYW1lVG9QaG9uZVR5cGVLZXkgKHR5cGVOYW1lOiBzdHJpbmcpIHtcclxuICBzd2l0Y2ggKHR5cGVOYW1lKSB7XHJcbiAgICBjYXNlIFwiSG9tZVwiOiByZXR1cm4gXCIwXCI7XHJcbiAgICBjYXNlIFwiV29ya1wiOiByZXR1cm4gXCIxXCI7XHJcbiAgICBjYXNlIFwiQ2VsbFwiOiByZXR1cm4gXCIyXCI7XHJcbiAgICBjYXNlIFwiT3RoZXJcIjogcmV0dXJuIFwiM1wiO1xyXG4gICAgZGVmYXVsdDogdGhyb3cgbmV3IEluY2lkZW50IChcclxuICAgICAgXCJ1bmtub3duLXBob25lLXR5cGUtbmFtZVwiLFxyXG4gICAgICB7dHlwZU5hbWU6IHR5cGVOYW1lfSxcclxuICAgICAgYFVua253b24gcGhvbmUgdHlwZSBuYW1lICR7dHlwZU5hbWV9YFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIGdpdGh1YjpkZW11cmdvcy9za3lwZS13ZWItcmV2ZXJzZWQgLT4galNreXBlL21vZGVsSGVscGVycy9jb250YWN0cy9kYXRhTWFwcGVycy9kYXRhTWFwcy5qc1xyXG5mdW5jdGlvbiBwaG9uZVR5cGVLZXlUb1Bob25lVHlwZU5hbWUgKHR5cGVLZXk6IHN0cmluZykge1xyXG4gIHN3aXRjaCAodHlwZUtleSkge1xyXG4gICAgY2FzZSBcIjBcIjogcmV0dXJuIFwiSG9tZVwiO1xyXG4gICAgY2FzZSBcIjFcIjogcmV0dXJuIFwiV29ya1wiO1xyXG4gICAgY2FzZSBcIjJcIjogcmV0dXJuIFwiQ2VsbFwiO1xyXG4gICAgY2FzZSBcIjNcIjogcmV0dXJuIFwiT3RoZXJcIjtcclxuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBJbmNpZGVudCAoXHJcbiAgICAgIFwidW5rbm93bi1waG9uZS10eXBlLWtleVwiLFxyXG4gICAgICB7dHlwZUNvZGU6IHR5cGVLZXl9LFxyXG4gICAgICBgVW5rbndvbiBwaG9uZSB0eXBlIGtleSAke3R5cGVLZXl9YFxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuIl19
